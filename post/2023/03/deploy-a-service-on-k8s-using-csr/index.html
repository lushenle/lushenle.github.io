<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <script type="application/ld+json">

{  
  "@context":"http://schema.org",
  "@type":"Website",
  "@id":"https:\/\/shenle.lu\/",
  "author": {
    "@type": "Person",
    "name": "Shenle Lu",
    
    "image": "https://www.gravatar.com/avatar/e7e1230b8763fb755cd0b39124913236"
    
  },
  "name":"Shenle Lu\u0027s Blog",
  "description":"",
  "url":"https:\/\/shenle.lu\/post\/2023\/03\/deploy-a-service-on-k8s-using-csr\/",
  "keywords":"[tech, Kubernetes]"
}

</script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.111.3 with theme Tranquilpeak 0.5.3-BETA">
<meta name="author" content="Shenle Lu">
<meta name="keywords" content="tech, Kubernetes">
<meta name="description" content="">


<meta property="og:description" content="">
<meta property="og:type" content="article">
<meta property="og:title" content="Deploy a Service on K8S Using CSR Provide TLS">
<meta name="twitter:title" content="Deploy a Service on K8S Using CSR Provide TLS">
<meta property="og:url" content="https://shenle.lu/post/2023/03/deploy-a-service-on-k8s-using-csr/">
<meta property="twitter:url" content="https://shenle.lu/post/2023/03/deploy-a-service-on-k8s-using-csr/">
<meta property="og:site_name" content="Shenle Lu&#39;s Blog">
<meta property="og:description" content="">
<meta name="twitter:description" content="">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2023-03-23T19:49:51">
  
  
    <meta property="article:modified_time" content="2023-03-23T19:49:51">
  
  
  
    
      <meta property="article:section" content="Kubernetes">
    
      <meta property="article:section" content="Container">
    
  
  
    
      <meta property="article:tag" content="Kubernetes">
    
      <meta property="article:tag" content="Container">
    
      <meta property="article:tag" content="Golang">
    
  


<meta name="twitter:card" content="summary">

  <meta name="twitter:site" content="@lushenle">


  <meta name="twitter:creator" content="@lushenle">






  <meta property="og:image" content="https://www.gravatar.com/avatar/e7e1230b8763fb755cd0b39124913236?s=640">
  <meta property="twitter:image" content="https://www.gravatar.com/avatar/e7e1230b8763fb755cd0b39124913236?s=640">






    <title>Deploy a Service on K8S Using CSR Provide TLS</title>

    <link rel="icon" href="https://shenle.lu/favicon.png">
    

    

    <link rel="canonical" href="https://shenle.lu/post/2023/03/deploy-a-service-on-k8s-using-csr/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.css" integrity="sha512-MLcK/YRapzET1qTBXrOiZE6bGBgtATMo2bIyalVJ8EKDEGNoeA3SPQkvWAR0zNS650YG13ocXBMeioDuZcSRuQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    
    
    <link rel="stylesheet" href="https://shenle.lu/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css" />
    
    

    
      
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7PSKWF3B39"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-7PSKWF3B39', { 'anonymize_ip': false });
}
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://shenle.lu/" aria-label="Go to homepage">Shenle Lu&#39;s Blog</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://shenle.lu/#about" aria-label="Open the link: /#about">
    
    
    
      
        <img class="header-picture" src="https://www.gravatar.com/avatar/e7e1230b8763fb755cd0b39124913236?s=90" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://shenle.lu/#about" aria-label="Read more about the author">
          <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/e7e1230b8763fb755cd0b39124913236?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Shenle Lu</h4>
        
          <h5 class="sidebar-profile-bio">Cloud Native Enginner, Guitarist, Drummer. Sport Pilot</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://shenle.lu/" title="Home">
    
      <i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://shenle.lu/categories" title="Categories">
    
      <i class="sidebar-button-icon fas fa-lg fa-bookmark" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://shenle.lu/tags" title="Tags">
    
      <i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://shenle.lu/archives" title="Archives">
    
      <i class="sidebar-button-icon fas fa-lg fa-archive" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://shenle.lu/#about" title="About">
    
      <i class="sidebar-button-icon fas fa-lg fa-question" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/lushenle" target="_blank" rel="noopener" title="GitHub">
    
      <i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/lushenle" target="_blank" rel="noopener" title="Twitter">
    
      <i class="sidebar-button-icon fab fa-lg fa-twitter" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.instagram.com/lushenle/" target="_blank" rel="noopener" title="Instagram">
    
      <i class="sidebar-button-icon fab fa-lg fa-instagram" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Instagram</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.linkedin.com/in/shenle-lu-b52255222/" target="_blank" rel="noopener" title="LinkedIn">
    
      <i class="sidebar-button-icon fab fa-lg fa-linkedin" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">LinkedIn</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://stackoverflow.com/users/17026153/shenle-lu" target="_blank" rel="noopener" title="Stack Overflow">
    
      <i class="sidebar-button-icon fab fa-lg fa-stack-overflow" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Stack Overflow</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://shenle.lu/index.xml" title="RSS">
    
      <i class="sidebar-button-icon fas fa-lg fa-rss" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post" id="top">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title">
      Deploy a Service on K8S Using CSR Provide TLS
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2023-03-23T19:49:51&#43;08:00">
        
  March 23, 2023

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="https://shenle.lu/categories/kubernetes">Kubernetes</a>, 
    
      <a class="category-link" href="https://shenle.lu/categories/container">Container</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              <h1 id="table-of-contents">Table of Contents</h1>
<nav id="TableOfContents">
  <ul>
    <li><a href="#certificatesigningrequest">CertificateSigningRequest</a></li>
    <li><a href="#generate-a-self-signed-certificate">Generate a Self-Signed Certificate</a></li>
    <li><a href="#deploy-service-and-use-self-signed-certificate">Deploy Service and Use Self-Signed Certificate</a></li>
    <li><a href="#verification">Verification</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>

<p>Transport Layer Security (TLS) encrypts data sent over the Internet to ensure that eavesdroppers and hackers are unable to see what you transmit which is particularly useful for private and sensitive information such as passwords, credit card numbers, and personal correspondence.</p>
<h2 id="certificatesigningrequest">CertificateSigningRequest</h2>
<p>Kubernetes CertificateSigningRequest objects provide a mechanism to obtain x509 certificates by submitting a certificate signing request, and having it asynchronously approved and issued.</p>
<p>Kubelets use this API to obtain:</p>
<ul>
<li>client certificates to authenticate to kube-apiserver (with the <code>kubernetes.io/kube-apiserver-client-kubelet</code> signerName).</li>
<li>serving certificates for TLS endpoints kube-apiserver can connect to securely (with the <code>kubernetes.io/kubelet-serving</code> signerName).</li>
</ul>
<p>This API can be used to request client certificates to authenticate to kube-apiserver (with the <code>kubernetes.io/kube-apiserver-client</code> signerName), or to obtain certificates from custom non-Kubernetes signers.</p>
<h2 id="generate-a-self-signed-certificate">Generate a Self-Signed Certificate</h2>
<p>Create a private key for the certificate:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>openssl genrsa -out myservice.key <span style="color:#a5d6ff">2048</span>
</span></span></code></pre></div><p>Generate a Certificate Signing Request (CSR) using the private key:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>openssl req -new -key myservice.key -out myservice.csr -subj <span style="color:#a5d6ff">&#34;/CN=myservice.default.svc.cluster.local&#34;</span>
</span></span></code></pre></div><blockquote>
<p>Replace <code>myservice.default.svc.cluster.local</code> with the fully qualified domain name (FQDN) of your service.</p>
</blockquote>
<p>Create a CSR YAML file, e.g., <code>myservice-csr.yaml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#7ee787">apiVersion</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">certificates.k8s.io/v1</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span><span style="color:#7ee787">kind</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">CertificateSigningRequest</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span><span style="color:#7ee787">metadata</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#7ee787">name</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">myservice</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span><span style="color:#7ee787">spec</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#7ee787">request</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">&lt;base64-encoded-csr&gt;</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#7ee787">signerName</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">kubernetes.io/kube-apiserver-client</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#7ee787">usages</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>- <span style="color:#a5d6ff">digital signature</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>- <span style="color:#a5d6ff">key encipherment</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>- <span style="color:#a5d6ff">client auth</span><span style="color:#6e7681">
</span></span></span></code></pre></div><blockquote>
<p>Replace <code>&lt;base64-encoded-csr&gt;</code> with the Base64-encoded CSR:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat myservice.csr | base64 | tr -d <span style="color:#a5d6ff">&#39;\n&#39;</span>
</span></span></code></pre></div><p>Apply the CSR YAML file and approve the CSR:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f myservice-csr.yaml
</span></span><span style="display:flex;"><span>kubectl certificate approve myservice
</span></span></code></pre></div><p>Retrieve the issued certificate:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get csr myservice -o <span style="color:#79c0ff">jsonpath</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;{.status.certificate}&#39;</span> | base64 --decode &gt; myservice.crt
</span></span></code></pre></div><p>Create a Kubernetes secret containing the private key and the issued certificate:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create secret tls myservice-tls --cert<span style="color:#ff7b72;font-weight:bold">=</span>myservice.crt --key<span style="color:#ff7b72;font-weight:bold">=</span>myservice.key
</span></span></code></pre></div><p>That&rsquo;s it. Our TLS certificate is ready.</p>
<h2 id="deploy-service-and-use-self-signed-certificate">Deploy Service and Use Self-Signed Certificate</h2>
<p>Update our service deployment to use the secret for TLS termination. Modify our Kubernetes deployment YAML file to include the secret and the appropriate volume mounts</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#7ee787">apiVersion</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">apps/v1</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span><span style="color:#7ee787">kind</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">Deployment</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span><span style="color:#7ee787">metadata</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#7ee787">name</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">myservice</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span><span style="color:#7ee787">spec</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#7ee787">replicas</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">1</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#7ee787">selector</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#7ee787">matchLabels</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#7ee787">app</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">myservice</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#7ee787">template</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#7ee787">metadata</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#7ee787">labels</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">        </span><span style="color:#7ee787">app</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">myservice</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#7ee787">spec</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#7ee787">containers</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>- <span style="color:#7ee787">name</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">myservice-container</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">        </span><span style="color:#7ee787">image</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">myservice-image</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">        </span><span style="color:#7ee787">ports</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">        </span>- <span style="color:#7ee787">containerPort</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">8443</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">        </span><span style="color:#7ee787">volumeMounts</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">        </span>- <span style="color:#7ee787">name</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">myservice-tls</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">          </span><span style="color:#7ee787">mountPath</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">&#34;/etc/tls&#34;</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">          </span><span style="color:#7ee787">readOnly</span>:<span style="color:#6e7681"> </span><span style="color:#79c0ff">true</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#7ee787">volumes</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>- <span style="color:#7ee787">name</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">myservice-tls</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">        </span><span style="color:#7ee787">secret</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">          </span><span style="color:#7ee787">secretName</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">myservice-tls</span><span style="color:#6e7681">
</span></span></span></code></pre></div><p>Deploy the updated service:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f myservice-deployment.yaml
</span></span></code></pre></div><h2 id="verification">Verification</h2>
<p>Use the following command for verification:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>echo | openssl s_client -showcerts -servername myservice.default.svc.cluster.local -connect myservice.default.svc.cluster.local:443
</span></span></code></pre></div><p>We should see the following output:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#79c0ff">depth</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span> <span style="color:#79c0ff">CN</span> <span style="color:#ff7b72;font-weight:bold">=</span> myservice.default.svc.cluster.local
</span></span><span style="display:flex;"><span>verify error:num<span style="color:#ff7b72;font-weight:bold">=</span>20:unable to get local issuer certificate
</span></span><span style="display:flex;"><span>verify <span style="color:#ff7b72">return</span>:1
</span></span><span style="display:flex;"><span><span style="color:#79c0ff">depth</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span> <span style="color:#79c0ff">CN</span> <span style="color:#ff7b72;font-weight:bold">=</span> myservice.default.svc.cluster.local
</span></span><span style="display:flex;"><span>verify error:num<span style="color:#ff7b72;font-weight:bold">=</span>26:unsupported certificate purpose
</span></span><span style="display:flex;"><span>verify <span style="color:#ff7b72">return</span>:1
</span></span><span style="display:flex;"><span><span style="color:#79c0ff">depth</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span> <span style="color:#79c0ff">CN</span> <span style="color:#ff7b72;font-weight:bold">=</span> myservice.default.svc.cluster.local
</span></span><span style="display:flex;"><span>verify error:num<span style="color:#ff7b72;font-weight:bold">=</span>21:unable to verify the first certificate
</span></span><span style="display:flex;"><span>verify <span style="color:#ff7b72">return</span>:1
</span></span><span style="display:flex;"><span>write W BLOCK
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>Certificate chain
</span></span><span style="display:flex;"><span> <span style="color:#a5d6ff">0</span> s:/CN<span style="color:#ff7b72;font-weight:bold">=</span>myservice.default.svc.cluster.local
</span></span><span style="display:flex;"><span>   i:/CN<span style="color:#ff7b72;font-weight:bold">=</span>kubernetes
</span></span><span style="display:flex;"><span>-----BEGIN CERTIFICATE-----
</span></span><span style="display:flex;"><span>MIIDJDCCAgygAwIBAgIRAJT0AGOQv8KhD6VUrbPMB/owDQYJKoZIhvcNAQELBQAw
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>98/yeCTMfkYsjgAUlkisaC1KkEg3ROsYbEkWowUqj8E2gdGd7AMtSQ<span style="color:#ff7b72;font-weight:bold">==</span>
</span></span><span style="display:flex;"><span>-----END CERTIFICATE-----
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>Server certificate
</span></span><span style="display:flex;"><span><span style="color:#79c0ff">subject</span><span style="color:#ff7b72;font-weight:bold">=</span>/CN<span style="color:#ff7b72;font-weight:bold">=</span>myservice.default.svc.cluster.local
</span></span><span style="display:flex;"><span><span style="color:#79c0ff">issuer</span><span style="color:#ff7b72;font-weight:bold">=</span>/CN<span style="color:#ff7b72;font-weight:bold">=</span>kubernetes
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>No client certificate CA names sent
</span></span><span style="display:flex;"><span>Server Temp Key: ECDH, X25519, <span style="color:#a5d6ff">253</span> bits
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>SSL handshake has read <span style="color:#a5d6ff">1368</span> bytes and written <span style="color:#a5d6ff">411</span> bytes
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>New, TLSv1/SSLv3, Cipher is AEAD-AES256-GCM-SHA384
</span></span><span style="display:flex;"><span>Server public key is <span style="color:#a5d6ff">2048</span> bit
</span></span><span style="display:flex;"><span>Secure Renegotiation IS NOT supported
</span></span><span style="display:flex;"><span>Compression: NONE
</span></span><span style="display:flex;"><span>Expansion: NONE
</span></span><span style="display:flex;"><span>No ALPN negotiated
</span></span><span style="display:flex;"><span>SSL-Session:
</span></span><span style="display:flex;"><span>    Protocol  : TLSv1.3
</span></span><span style="display:flex;"><span>    Cipher    : AEAD-AES256-GCM-SHA384
</span></span><span style="display:flex;"><span>    Session-ID:
</span></span><span style="display:flex;"><span>    Session-ID-ctx:
</span></span><span style="display:flex;"><span>    Master-Key:
</span></span><span style="display:flex;"><span>    Start Time: <span style="color:#a5d6ff">1679662991</span>
</span></span><span style="display:flex;"><span>    Timeout   : <span style="color:#a5d6ff">7200</span> <span style="color:#ff7b72;font-weight:bold">(</span>sec<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    Verify <span style="color:#ff7b72">return</span> code: <span style="color:#a5d6ff">21</span> <span style="color:#ff7b72;font-weight:bold">(</span>unable to verify the first certificate<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>DONE
</span></span></code></pre></div><p>We can see that the issuer is <code>Kubernetes</code>. It was great. It was just right!</p>
<h2 id="conclusion">Conclusion</h2>
<p>This article introduces how to use CertificateSigningRequest for our application to generate the self-signed certificates.</p>
<p>While the self-signed certificates should not be used in production, they provide an easy way to test the apps you deploy with Kubernetes.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://kubernetes.io/docs/reference/kubernetes-api/authentication-resources/certificate-signing-request-v1/">https://kubernetes.io/docs/reference/kubernetes-api/authentication-resources/certificate-signing-request-v1/</a></li>
<li><a href="https://jimmysong.io/kubernetes-handbook/guide/managing-tls-in-a-cluster.html">https://jimmysong.io/kubernetes-handbook/guide/managing-tls-in-a-cluster.html</a></li>
</ul>
              


            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://shenle.lu/tags/kubernetes/">Kubernetes</a>

  <a class="tag tag--primary tag--small" href="https://shenle.lu/tags/container/">Container</a>

  <a class="tag tag--primary tag--small" href="https://shenle.lu/tags/golang/">Golang</a>

                  </div>
                
              
            
            
<div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--disabled">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://shenle.lu/post/2023/03/k8s-tokenrequest-api/" data-tooltip="K8S TokenRequest API" aria-label="PREVIOUS: K8S TokenRequest API">
          
              <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
<ul class="post-actions post-action-share" >
  
    <li class="post-action hide-lg hide-md hide-sm">
      <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
        <i class="fa fa-share-alt" aria-hidden="true"></i>
      </a>
    </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://shenle.lu/post/2023/03/deploy-a-service-on-k8s-using-csr/" title="Share on Facebook" aria-label="Share on Facebook">
          <i class="fab fa-facebook-square" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://shenle.lu/post/2023/03/deploy-a-service-on-k8s-using-csr/" title="Share on Twitter" aria-label="Share on Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/sharing/share-offsite/?url=https://shenle.lu/post/2023/03/deploy-a-service-on-k8s-using-csr/" title="Share on Linkedin" aria-label="Share on Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i>
        </a>
      </li>
    
  
  
    <li class="post-action">
      <a class="post-action-btn btn btn--default" href="#gitalk" aria-label="Leave a comment">
        <i class="fa fa-comment"></i>
      </a>
    </li>
  
  <li class="post-action">
    
      <a class="post-action-btn btn btn--default" href="#top" aria-label="Back to top">
      <i class="fa fa-arrow-up" aria-hidden="true"></i>
    
    </a>
  </li>
</ul>
</div>


            
  
    <div id="gitalk">
      <noscript>Please enable JavaScript to view the comments powered by Gitalk.</noscript>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.min.js" integrity="sha512-EcTCcXV46teiNwe0VcnM5A038tcY+BaQYO4nW6Gh2i7v4/HjBVg7xx3+JBLl9WofDds//INJAiEGAtdgr8PWyA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="text/javascript">
      (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
          document.getElementById('gitalk').innerHTML = 'Gitalk comments not available by default when the website is previewed locally.';
          return;
        }
        new Gitalk({
          clientID: 'ac713dbb5a422f9107dd',
          clientSecret: 'f4225291e2d478e9f9fdb2af6d5245f95eefdb5f',
          repo: 'lushenle.github.io',
          owner: 'lushenle',
          admin: ['lushenle'],
          id: '153fa36fe16763c95d4b7b234928b52a',
          ...{"distractionfreemode":false,"enablehotkey":true,"language":"en","pagerdirection":"first","perpage":10}
        }).render('gitalk')
      })()
    </script>
  


          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2023 Shenle Lu. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
<div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--disabled">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://shenle.lu/post/2023/03/k8s-tokenrequest-api/" data-tooltip="K8S TokenRequest API" aria-label="PREVIOUS: K8S TokenRequest API">
          
              <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
<ul class="post-actions post-action-share" >
  
    <li class="post-action hide-lg hide-md hide-sm">
      <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
        <i class="fa fa-share-alt" aria-hidden="true"></i>
      </a>
    </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://shenle.lu/post/2023/03/deploy-a-service-on-k8s-using-csr/" title="Share on Facebook" aria-label="Share on Facebook">
          <i class="fab fa-facebook-square" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://shenle.lu/post/2023/03/deploy-a-service-on-k8s-using-csr/" title="Share on Twitter" aria-label="Share on Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/sharing/share-offsite/?url=https://shenle.lu/post/2023/03/deploy-a-service-on-k8s-using-csr/" title="Share on Linkedin" aria-label="Share on Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i>
        </a>
      </li>
    
  
  
    <li class="post-action">
      <a class="post-action-btn btn btn--default" href="#gitalk" aria-label="Leave a comment">
        <i class="fa fa-comment"></i>
      </a>
    </li>
  
  <li class="post-action">
    
      <a class="post-action-btn btn btn--default" href="#top" aria-label="Back to top">
      <i class="fa fa-arrow-up" aria-hidden="true"></i>
    
    </a>
  </li>
</ul>
</div>


      </div>
      
<div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-times"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fshenle.lu%2Fpost%2F2023%2F03%2Fdeploy-a-service-on-k8s-using-csr%2F" aria-label="Share on Facebook">
          <i class="fab fa-facebook-square" aria-hidden="true"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fshenle.lu%2Fpost%2F2023%2F03%2Fdeploy-a-service-on-k8s-using-csr%2F" aria-label="Share on Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fshenle.lu%2Fpost%2F2023%2F03%2Fdeploy-a-service-on-k8s-using-csr%2F" aria-label="Share on Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i><span>Share on Linkedin</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>


    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-times"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.gravatar.com/avatar/e7e1230b8763fb755cd0b39124913236?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Shenle Lu</h4>
    
      <div id="about-card-bio">Cloud Native Enginner, Guitarist, Drummer. Sport Pilot</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior DevOps Engineer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker-alt"></i>
        <br/>
        Beijing, China
      </div>
    
  </div>
</div>

    

    
  
    
      <div id="cover" style="background-image:url('https://shenle.lu/images/cover.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js" integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://shenle.lu/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js"></script>


  
    <script async crossorigin="anonymous" defer integrity="sha512-gE8KAQyFIzV1C9+GZ8TKJHZS2s+n7EjNtC+IMRn1l5+WYJTHOODUM6JSjZhFhqXmc7bG8Av6XXpckA4tYhflnw==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/apache.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-EWROca+bote+7Oaaar1F6y74iZj1r1F9rm/ly7o+/FwJopbBaWtsFDmaKoZDd3QiGU2pGacBirHJNivmGLYrow==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/go.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-GDVzAn0wpx1yVtQsRWmFc6PhJiLBPdUic+h4GWgljBh904O3JU10fk9EKNpVyIoPqkFn54rgL2QBG4BmUTMpiQ==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/http.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-UgZlma8NzkrDb/NWgmLIcTrH7i/CSnLLDRFqCSNF5NGPpjKmzyM25qcoXGOup8+cDakKyaiTDd7N4dyH4YT+IA==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/less.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-lot9koe73sfXIrUvIPM/UEhuMciN56RPyBdOyZgfO53P2lkWyyXN7J+njcxIIBRV+nVDQeiWtiXg+bLAJZDTfg==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/nginx.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-Zd3e7XxHP00TD0Imr0PIfeM0fl0v95kMWuhyAS3Wn1UTSXTkz0OhtRgBAr4JlmADRgiXr4x7lpeUdqaGN8xIog==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/puppet.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-qtqDO052iXMSP+5d/aE/jMtL9vIIGvONgTJziC2K/ZIB1yEGa55WVxGE9/08rSQ62EoDifS9SWVGZ7ihSLhzMA==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/scss.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-1NmkjnEDnwwwcu28KoQF8vs3oaPFokQHbmbtwGhFfeDsQZtVFI8zW2aE9O8yMYdpdyKV/5blE4pSWw4Z/Sv97w==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/stylus.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-B2wSfruPjr8EJL6IIzQr1eAuDwrsfIfccNf/LCEdxELCgC/S/ZMt/Uvk80aD79m7IqOqW+Sw8nbkvha20yZpzg==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/swift.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-28oDiQZGKUVN6wQ7PSLPNipOcmkCALXKwOi7bnkyFf8QiMZQxG9EQoy/iiNx6Zxj2cG2SbVa4dXKigQhu7GiFw==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/yaml.min.js"></script>
  


<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous"></script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      CommonHTML: { linebreaks: { automatic: true } },
      tex2jax: { inlineMath: [ ['$', '$'], ['\\(','\\)'] ], displayMath: [ ['$$','$$'], ['\\[', '\\]'] ], processEscapes: false },
      messageStyle: 'none'
    });
  </script>



    
  </body>
</html>

